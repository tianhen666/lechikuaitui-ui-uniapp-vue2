<template>
  <view>
    <!--












		æ³¨æ„ï¼šè¿™æ˜¯ H5ã€å¾®ä¿¡å°ç¨‹åºç•Œé¢ï¼Œè¯·å‹¿å’Œ new_index.nvueã€index.nvue æ··ç”¨

		1. new_index.nvueã€index.nvueè¿™ä¸¤ä¸ªæ˜¯Appé¡µé¢

		2. å¦å¤–ï¼šdata.js æ˜¯ä¸Šä¸€ç‰ˆæœ¬ç•™ä¸‹çš„å‡æ•°æ®ï¼Œè¿™ä¸€ç‰ˆæ”¹æˆäº† URL è¯·æ±‚äº†ï¼ˆå¦‚ä¸éœ€è¦å¯ä»¥åˆ é™¤ï¼Œä¹Ÿå¯ä½œä¸ºåç«¯è¯·æ±‚å‚è€ƒï¼‰

		3. è¯·å„ä½å¤§ç¥å¤šå¤šç•™æ‰‹ï¼Œæˆ‘å·²ç»æŠŠè¯·æ±‚å†…å­˜å¼€åˆ°æœ€å¤§äº†

		4. è§†é¢‘ id åˆ‡è®°æ˜¯å­—ç¬¦ä¸²ç±»å‹









		 -->
    <!-- #ifdef MP -->
    <swiper
      :style="
        'width: ' + windowWidth + 'px; height: ' + windowHeight + 'px; background-color: #000000;'
      "
      :vertical="true"
      @animationfinish="animationfinish"
      @change="change"
      :current="current"
      :indicator-dots="false"
      @touchstart="mpTouchstart"
      @touchend="mpTouchend"
    >
      <swiper-item v-for="(list, index) in dataList" :key="index">
        <view v-if="Math.abs(k - index) <= 1">
          <view style="font-size: 0;">
            <!--
						1.v-ifï¼šç”¨äºæ§åˆ¶è§†é¢‘åœ¨èŠ‚ç‚¹çš„æ¸²æŸ“æ•°
						2.mutedçš„é»˜è®¤å€¼æ˜¯ falseï¼Œä»£è¡¨é»˜è®¤æ˜¯ç¦éŸ³è§†é¢‘çš„
						3.http-cacheé»˜è®¤å¼€å¯è§†é¢‘ç¼“å­˜
						4.posterï¼ˆå°é¢ï¼ˆæ–¹æ¡ˆä¸€ï¼‰ï¼‰ï¼šè¿™é‡Œçš„å°é¢é»˜è®¤å¤„ç†å­˜å‚¨åœ¨é˜¿é‡Œäº‘çš„è§†é¢‘
						5.show-loadingï¼šè¿™é‡Œé»˜è®¤å»æ‰æ’­æ”¾è½¬åœˆçš„æ ‡å¿—
						v-if="Math.abs(k-index)<=1"
						 -->
            <video
              v-if="isShow"
              :id="list._id + '_' + index"
              :loop="true"
              :muted="list.isplay"
              :controls="false"
              :http-cache="true"
              :page-gesture="false"
              :show-fullscreen-btn="false"
              :show-loading="false"
              :show-center-play-btn="false"
              :enable-progress-gesture="false"
              :src="list.src"
              @ended="ended"
              @tap.stop="tapVideoHover(list.state, $event)"
              :style="
                'width: ' +
                  windowWidth +
                  'px; height: ' +
                  windowHeight +
                  'px; background-color: #000000; z-index: -1;'
              "
              :poster="list.src + '?x-oss-process=video/snapshot,t_100,f_jpg'"
            ></video>
            <!--
						1.è¿™é‡Œæ˜¯å°é¢ï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼šè¿™é‡Œçš„å°é¢å¯ä»¥è‡ªå®šä¹‰ã€‚
						2.ä¹Ÿåœ¨ä»£ç ä¸­åšäº†æ‰¹æ³¨ï¼Œä¸¤ç§æ–¹æ¡ˆå¯ä»¥å…±å­˜ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚
						-->
            <image
              v-if="!list.playIng"
              :src="list.src + '?x-oss-process=video/snapshot,t_100,f_jpg'"
              :style="
                'width: ' + windowWidth + 'px; height: ' + windowHeight + 'px; position: absolute;'
              "
              mode="aspectFit"
            ></image>
          </view>
          <!-- æ’­æ”¾çŠ¶æ€ï¼špause çš„æ—¶å€™å°±ä¼šæš‚åœ -->
          <view
            class="videoHover"
            @tap.stop="tapVideoHover(list.state, $event)"
            :style="'width: ' + windowWidth + 'px; height: ' + windowHeight + 'px;'"
          >
            <image
              v-if="list.state == 'pause'"
              class="playState"
              src="@/static/img/index/play.png"
            ></image>
          </view>
          <!-- æœ€åº•ä¸‹çš„æ–‡å­—éƒ¨åˆ† -->
          <view class="content">
            <text class="userName" :style="'width: ' + (windowWidth - 90) + 'px;'">
              {{ list.title }}
            </text>
            <!-- i={{i}} -->
            <text class="words" :style="'width: ' + (windowWidth - 90) + 'px;'">
              {{ list.msg }}-{{ k + 1 }}
            </text>
            <!-- k={{k}} -->
          </view>
        </view>
      </swiper-item>
    </swiper>
    <!-- #endif -->
    <!-- #ifdef H5 -->
    <swiper
      :style="
        'width: ' + windowWidth + 'px; height: ' + windowHeight + 'px; background-color: #fff;'
      "
      :vertical="true"
      @animationfinish="animationfinish"
      @change="change"
      :current="current"
      :indicator-dots="false"
      :duration="duration"
    >
      <swiper-item v-for="(list, index) in dataList" :key="index">
        <view
          v-if="Math.abs(k - index) <= 1"
          :style="'width: ' + windowWidth + 'px; height: ' + windowHeight + 'px;'"
        >
          <view style="position: absolute;">
            <!--
						1.v-ifï¼šç”¨äºæ§åˆ¶è§†é¢‘åœ¨èŠ‚ç‚¹çš„æ¸²æŸ“æ•°
						2.mutedçš„é»˜è®¤å€¼æ˜¯ falseï¼Œä»£è¡¨é»˜è®¤æ˜¯ç¦éŸ³è§†é¢‘çš„
						3.http-cacheé»˜è®¤å¼€å¯è§†é¢‘ç¼“å­˜
						4.posterï¼ˆå°é¢ï¼ˆæ–¹æ¡ˆä¸€ï¼‰ï¼‰ï¼šè¿™é‡Œçš„å°é¢é»˜è®¤å¤„ç†å­˜å‚¨åœ¨é˜¿é‡Œäº‘çš„è§†é¢‘
						5.show-loadingï¼šè¿™é‡Œé»˜è®¤å»æ‰æ’­æ”¾è½¬åœˆçš„æ ‡å¿—
						v-if="Math.abs(k-index)<=1"
						 -->
            <video
              v-if="isShow"
              :id="list._id + '_' + index"
              :loop="false"
              :muted="list.isplay"
              :controls="false"
              :http-cache="true"
              :page-gesture="false"
              :show-fullscreen-btn="false"
              :show-loading="false"
              :show-center-play-btn="false"
              :enable-progress-gesture="false"
              :src="list.src"
              @ended="ended"
              @timeupdate="timeupdate"
              @loadedmetadata="endLoading"
              @tap.stop="tapVideoHover(list.state, $event)"
              :style="
                'width: ' +
                  boxStyle.width +
                  'px; height: ' +
                  boxStyle.height +
                  'px; background-color: #000000; z-index: -1;'
              "
              :poster="list.src + '?vframe/jpg/offset/1/w/600'"
            ></video>
            <!--
						1.è¿™é‡Œæ˜¯å°é¢ï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼šè¿™é‡Œçš„å°é¢å¯ä»¥è‡ªå®šä¹‰ã€‚
						2.ä¹Ÿåœ¨ä»£ç ä¸­åšäº†æ‰¹æ³¨ï¼Œä¸¤ç§æ–¹æ¡ˆå¯ä»¥å…±å­˜ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚
						-->
            <image
              v-if="!list.playIng"
              :src="list.src + '?vframe/jpg/offset/1/w/600'"
              :style="
                'width: ' +
                  boxStyle.width +
                  'px; height: ' +
                  boxStyle.height +
                  'px; position: absolute;'
              "
              mode="aspectFit"
            ></image>
          </view>

          <!-- æ’­æ”¾çŠ¶æ€ï¼špause çš„æ—¶å€™å°±ä¼šæš‚åœ -->
          <view
            class="videoHover"
            @tap.stop="tapVideoHover(list.state, $event)"
            :style="'width: ' + boxStyle.width + 'px; height: ' + boxStyle.height + 'px;'"
          >
            <image
              v-if="list.state == 'pause'"
              class="playState"
              src="@/static/img/index/play.png"
            ></image>
          </view>

          <!-- é—¨è¯Šä¿¡æ¯ ç­‰ä¸€äº›æŒ‰é’® -->
          <view style="position: absolute;width: 100%;bottom: 0;">
            <!-- æœ€åº•ä¸‹çš„æ–‡å­—éƒ¨åˆ† -->
            <view class="content" :style="'width: ' + (boxStyle.width - 90) + 'px;'">
              <text class="userName">{{ list.title }}</text>
              <text class="words" v-if="list.msg"># {{ list.msg }}</text>
            </view>

            <view style="margin:-10px -20px;">
              <u-slider
                v-model="dataList[k].playbackProgress"
                blockSize="10"
                min="0"
                style="margin:10rpx 30rpx;"
                backgroundColor="#d0d0d099"
                block-color="#ffffff99"
                activeColor="#007aff99"
                @changing="sliderChange"
                @change="sliderChange"
                step="0.05"
                :max="dataList[k].totalProgress"
              ></u-slider>
            </view>

            <!-- é—¨è¯Šä¿¡æ¯ æœ‰é‚€è¯·äºº -->
            <m-business-card-video-invitation
              v-if="!!invitationID && invitationID != userInfo.id"
            ></m-business-card-video-invitation>

            <!-- é—¨è¯Šä¿¡æ¯ æ²¡æœ‰é‚€è¯·äºº -->
            <m-business-card-video></m-business-card-video>
          </view>
        </view>
      </swiper-item>
    </swiper>
    <!-- #endif -->
  </view>
</template>

<script>
import { getSourceMaterialId, getSourceMaterial } from '@/api/materialLibrary.js';
import wx from '@/wxJsSDK/index.js';
import { mapState, mapGetters } from 'vuex';
import { delay } from '@/utils/index.js';
let audo = uni.createInnerAudioContext();
audo.loop = false;
export default {
  data() {
    return {
      windowWidth: 0,
      windowHeight: 0,
      platform: '',
      model: '',
      deleteHeight: 0,
      dataList: [],
      k: 0,
      oldVideo: '',
      voice: '',
      timeout: '',
      current: 0,
      boxStyle: {
        //è§†é¢‘ï¼Œå›¾ç‰‡å°é¢æ ·å¼ğŸŒŸğŸ’—
        height: 0,
        width: 0
      },

      classID: '', //åˆ†ç±»ID
      total: 2, //è§†é¢‘æ€»é‡
      mVideoID: '', // è§†é¢‘ID
      pageNo: 1, // å½“å‰åˆ†é¡µ
      pageSize: 10, // ä¸€é¡µå¤šå°‘ä¸ª

      videoID: '', // è§†é¢‘ID
      isShow: false,

      showPlay: false, //è½¬è½®æ˜¾ç¤ºæ§åˆ¶
      rotates: 0, //è½¬è½®æ—‹è½¬è§’åº¦
      rotateTime: '', //è½¬è½®é€’å½’äº‹ä»¶æ§åˆ¶
      xrotats: '', // å®šæ—¶å™¨ID
      mpcleartime: '', // ç‚¹å‡»æ—¶é—´
      isClick: false,
      changeTimeout: '',
      mptime: 0,
      mpstartTime: 0,
      duration: 500
    };
  },
  computed: {
    ...mapState({
      tenantInfo: state => state.tenant.info,
      userInfo: state => state.user.userInfo,
      invitationTenantInfo: state => state.tenant.invitationInfo,
      invitationUserInfo: state => state.user.invitationInfo
    }),
    ...mapGetters(['isMember', 'isTenantExpired'])
  },
  watch: {
    async k(k, old_k) {
      // console.log(k, old_k);
      // #ifndef MP
      this.clearToTime();
      // #endif
      this.isShow = false;
      this.dataList[old_k].playIng = false; //å¦‚æœè§†é¢‘æš‚åœï¼Œå°±åŠ è½½å°é¢
      this.dataList[old_k].isplay = true;
      this.dataList[old_k].state = 'pause';
      console.log('é¢„ç•™ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[old_k]._id + '_' + old_k);
      // 2.0ç‰ˆæœ¬å·²ç»å»æ‰äº†ä¸‹é¢è¿™ä¸€å¥ï¼Œè§†é¢‘ä¸ç”¨æš‚åœï¼Œåªéœ€è¦æŠŠå£°éŸ³ç¦æ­¢å°±è¡Œ
      uni.createVideoContext(this.dataList[old_k]._id + '_' + old_k, this).stop(); //å¦‚æœè§†é¢‘æš‚åœï¼Œé‚£ä¹ˆæ—§è§†é¢‘åœæ­¢ï¼Œè¿™é‡Œçš„this.dataList[old_k]._id + '_' + old_kï¼Œåé¢åŠ  old_k æ˜¯ä¸ºäº†æ¯ä¸€ä¸ªè§†é¢‘çš„ id å€¼ä¸åŒï¼Œè¿™æ ·å°±å¯ä»¥å¤§ç¨‹åº¦çš„é¿å…ä¸²éŸ³é—®é¢˜
      console.log('å·²ç»æš‚åœ --> ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï½'); //æç¤º
      this.dataList[k].state = 'play';
      this.isShow = true;
      this.xrotats = setTimeout(() => {
        this.showPlay = true;
        // #ifndef MP
        this.rotateX();
        // #endif
      }, 200);
      // #ifdef MP
      // å¦‚æœæ˜¯å°ç¨‹åºç«¯
      clearTimeout(this.changeTimeout);
      this.dataList[k].isplay = false;
      setTimeout(() => {
        this.dataList[k].playIng = true;
      }, 250);
      if (this.mptime < 0.2) {
        this.changeTimeout = setTimeout(() => {
          uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).play();
        }, 1400);
      } else {
        uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).play();
      }
      // #endif
      // #ifdef H5
      this.dataList[k].isplay = true;
      audo.src = this.dataList[k].src;
      if (this.isClick) {
        setTimeout(() => {
          if (typeof WeixinJSBridge == 'undefined') {
            setTimeout(() => {
              audo.play();
              uni.createVideoContext(this.dataList[k]._id + '_' + k, this).seek(0);
              uni.createVideoContext(this.dataList[k]._id + '_' + k, this).play();
              setTimeout(() => {
                this.dataList[k].playIng = true;
              }, 650);
            }, 500);
          } else {
            WeixinJSBridge.invoke('getNetworkType', {}, e => {
              setTimeout(() => {
                audo.play();
                uni.createVideoContext(this.dataList[k]._id + '_' + k, this).seek(0);
                uni.createVideoContext(this.dataList[k]._id + '_' + k, this).play();
                setTimeout(() => {
                  this.dataList[k].playIng = true;
                }, 850);
              }, 200);
            });
          }
        }, 200);
      } else {
        audo.pause();
        this.dataList[k].state = 'pause';
        uni.createVideoContext(this.dataList[k]._id + '_' + k, this).seek(0);
        uni.createVideoContext(this.dataList[k]._id + '_' + k, this).pause();
      }
      // #endif
      var p = k + 1;
      console.log('é¢„åŠ è½½ç¬¬' + (p + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[p]?._id + '_' + p);
    }
  },
  async onLoad({ id, classId, invitationID, invitationTenantID }) {
    // ç­‰å¾…onLaunchæ‰§è¡Œå®Œæˆ
    await this.$onLaunched;

    // è®¾ç½®è§†é¢‘ID
    this.mVideoID = Number(id) || 0;
    // åˆ†ç±»ID
    this.classID = Number(classId) || 0;
    // è®¾ç½®é‚€è¯·äººçš„ID
    this.invitationID = Number(invitationID) || 0;
    // é‚€è¯·çš„é—¨è¯ŠID
    this.invitationTenantID = Number(invitationTenantID) || 0;

    // è·å–é‚€è¯·äººçš„, ä¸ªäººä¿¡æ¯, é—¨è¯Šä¿¡æ¯
    if (invitationID && invitationTenantID) {
      this.$store.dispatch('invitationInfoFun', {
        clueId: invitationID,
        tenantId: invitationTenantID
      });

      this.$store.dispatch('getShareTenantInfo', {
        tenantId: invitationTenantID
      });
    }

    /* åˆ¤æ–­æ‰‹æœºå‹å· ---start--- */
    this.platform = uni.getSystemInfoSync().platform;
    this.model = uni.getSystemInfoSync().model;
    var model = this.model;
    if (
      this.platform == 'ios' &&
      (model !== 'iPhone6' || model !== 'iPhone6s' || model !== 'iPhone7' || model !== 'iPhone8')
    ) {
      this.deleteHeight = 0; //æœ‰ tabbarçš„ ä¿®æ”¹è¿™é‡Œå¯ä»¥æ”¹å˜è§†é¢‘é«˜åº¦
    }
    /* åˆ¤æ–­æ‰‹æœºå‹å· ---end---- */

    /* åˆå§‹å°ºå¯¸ä¿¡æ¯ start */
    this.windowWidth = uni.getSystemInfoSync().windowWidth;
    this.windowHeight = uni.getSystemInfoSync().windowHeight;
    this.boxStyle.width = this.windowWidth;
    this.boxStyle.height = this.windowHeight - this.deleteHeight - 90; //æœ‰ tabbarçš„ ä¿®æ”¹è¿™é‡Œå¯ä»¥æ”¹å˜è§†é¢‘é«˜åº¦
    /*  åˆå§‹å°ºå¯¸ä¿¡æ¯ end */

    /*  æ‰§è¡Œ---æ—‹è½¬åŠ¨ç”» */
    // #ifndef MP
    this.rotateX();
    // #endif

    // å¾®ä¿¡jsdkåˆå§‹åŒ–
    wx.initJssdk();

    // è·å–ä¸€ç»„æ•°æ®
    this.get();
  },
  onShow() {
    console.log('å›åˆ°å‰å°');
    if (this.dataList.length !== 0) {
      // #ifdef MP
      this.dataList[this.k].state = 'play';
      uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).play();
      // #endif

      // #ifdef H5
      if (this.isClick) {
        this.dataList[this.k].state = 'play';
        uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).play();
        audo.play();
      }
      // #endif
    }
  },
  onHide() {
    // #ifdef MP
    this.dataList[this.k].state = 'pause';
    uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).pause();
    // #endif

    // #ifdef H5
    if (this.isClick) {
      this.dataList[this.k].state = 'pause';
      uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).pause();
      audo.pause();
    }
    // #endif
    console.log('åˆ°åå°');
  },
  onUnload() {
    // #ifdef MP
    this.dataList[this.k].state = 'pause';
    uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).pause();
    // #endif

    // #ifdef H5
    if (this.isClick) {
      this.dataList[this.k].state = 'pause';
      uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).pause();
      audo.pause();
    }
    // #endif
    console.log('é¡µé¢é”€æ¯');
  },
  methods: {
    // å°ç¨‹åºç«¯è§¦æ‘¸ç»“æŸ
    mpTouchend() {
      this.mptime = new Date() / 1000 - this.mpstartTime;
    },

    // å°ç¨‹åºç«¯è§¦æ‘¸å¼€å§‹
    mpTouchstart() {
      this.mpstartTime = new Date() / 1000;
    },

    // ç‚¹å‡»æ˜¾ç¤ºå£°éŸ³æŒ‰é’®
    dealVoice() {
      uni.showToast({
        title: 'å¤„ç†å£°éŸ³',
        icon: 'none'
      });
    },

    //æ¸…ç†å®šæ—¶å™¨
    clearToTime() {
      for (let i = 0; i < 20; i++) {
        clearTimeout(this.rotateTime);
        clearTimeout(this.xrotats);
        this.showPlay = false;
        this.rotates = 0;
      }
    },

    //æ¸…ç†å®šæ—¶å™¨
    clearTime() {
      for (let i = 0; i < 20; i++) {
        clearTimeout(this.rotateTime);
        clearTimeout(this.xrotats);
      }
    },

    // è½¬åœˆå‡½æ•°
    rotateX() {
      // clearTimeout(this.rotateTime);
      this.rotateTime = setTimeout(() => {
        this.rotateX();
        this.showPlay = true;
        this.rotates += 1;
      }, 30);
    },

    // å…³é—­è¯„è®º
    closeScrollview() {
      // ç‚¹å‡»è¯„è®ºé‡Œé¢çš„å‰å‰ï¼Œå°±ä¼šå…³é—­è¯„è®º
      this.$refs.pinglun.close();
    },

    // è‡ªåŠ¨è§¦å‘ä¸‹ä¸€ä¸ªè§†é¢‘ loopå€¼è®¾ç½®ä¸ºfalse è§¦å‘
    ended() {
      // 1.æ’­æ”¾å½“å‰è§†é¢‘ç»“æŸæ—¶è§¦å‘ï¼Œè‡ªåŠ¨åˆ‡æ¢ä¸‹ä¸€ä¸ªè§†é¢‘
      this.current = this.k + 1;
    },

    //ç‚¹å‡»æ’­æ”¾&&æš‚åœ
    tapVideoHover(state, event) {
      console.log('state--', state);
      if (state == 'play' || state == 'continue') {
        this.dataList[this.k].state = 'pause';
      } else {
        this.dataList[this.k].state = 'continue';
      }
      if (this.dataList[this.k].state == 'continue') {
        this.isClick = true;
        this.dataList[this.k].playIng = true;
        uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).play(); //æš‚åœä»¥åç»§ç»­æ’­æ”¾
        // #ifdef MP
        this.dataList[this.k].isplay = false;
        // #endif
        // #ifdef H5
        audo.play();
        // #endif
      }
      if (this.dataList[this.k].state == 'pause') {
        uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).pause(); //æš‚åœä»¥åç»§ç»­æ’­æ”¾
        // #ifdef MP
        this.dataList[this.k].isplay = true;
        // #endif
        // #ifdef H5
        audo.pause();
        // #endif
      }
    },

    // swiper åˆ‡æ¢æ‰§è¡Œ
    async change(event) {
      this.k = event.detail.current;
      // è®¾ç½®è§†é¢‘ID
      this.videoID = this.dataList[this.k]._id;
      const res = await getSourceMaterialId({
        id: this.videoID,
        clueId: this.invitationID,
        clueTenantId: this.invitationTenantID
      });
      this.wxShare();
    },

    // swiper åˆ‡æ¢å®Œæˆæ‰§è¡Œ
    animationfinish(event) {
      // 1.è¿™é‡Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªè§†é¢‘å°±è¿›å…¥ get() æ–¹æ³•åŠ è½½è§†é¢‘è¿›å…¥åˆ—è¡¨
      if (this.k == this.dataList.length - 1) {
        this.GET();
      }
    },

    //æ¯ä¸€ç»„ç»“æŸæ—¶æ–°çš„è¯·æ±‚
    async GET() {
      if (this.dataList.length >= this.total) {
        return;
      }
      const res = await getSourceMaterial({
        pageNo: this.pageNo,
        pageSize: this.pageSize,
        classId: this.classID,
        type: 2 // è§†é¢‘åˆ†ç±»
      });
      this.pageNo = this.pageNo + 1;
      // 1.è¿™é‡Œå¼•å…¥åç«¯è¯·æ±‚æ•°æ®
      const msg = [...res.data.list];
      // 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
      for (let i = 0; i < msg.length; i++) {
        // å»é™¤å½“å‰åˆå§‹åŒ–è§†é¢‘
        if (this.mVideoID != msg[i].id) {
          this.dataList.push({
            playIng: false,
            isplay: true,
            _id: msg[i].id,
            title: msg[i].name,
            state: 'pause',
            src: msg[i].content,
            playbackProgress: 0,
            totalProgress: 0,
            resourceLoading: false
          });
        }
      }
      this.total = res.data.total;
    },

    // åˆå§‹åŒ–è¯·æ±‚çš„,ç¬¬ä¸€ç»„è§†é¢‘
    async get() {
      this.isShow = false;
      // ç¨å¾®å»¶æ—¶ä¸‹,é˜²æ­¢é‚€è¯·äººçš„ä¿¡æ¯æ²¡æœ‰åŠ è½½
      await delay(500);

      const res = await getSourceMaterialId({
        id: this.mVideoID,
        clueId: this.invitationID,
        clueTenantId: this.invitationTenantID
      });

      // 1.è¿™é‡Œå¼•å…¥åç«¯è¯·æ±‚æ•°æ®
      var msg = [res.data];

      // 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
      for (let i = 0; i < msg.length; i++) {
        this.dataList.push({
          playIng: false,
          isplay: true,
          _id: msg[i].id,
          title: msg[i].name,
          msg: msg[i].description,
          state: 'pause',
          src: msg[i].content,
          playbackProgress: 0,
          totalProgress: 0,
          resourceLoading: false
        });
      }

      // 3.æ˜¾ç¤ºè§†é¢‘
      this.isShow = true;

      // å¦‚æœæ˜¯å°ç¨‹åºç«¯  ç›´æ¥æ’­æ”¾è§†é¢‘
      // #ifdef MP
      this.dataList[this.k].isplay = false;
      this.dataList[this.k].state = 'play';
      this.dataList[this.k].playIng = true;
      uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).play();
      // #endif

      // h5ç«¯æœ‰é™åˆ¶,åˆå§‹åŠ è½½ä¸èƒ½ç›´æ¥æ’­æ”¾
      // #ifdef H5
      this.dataList[this.k].isplay = true;
      this.dataList[this.k].playIng = false;
      // uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).seek(0);
      // uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).pause();
      this.dataList[this.k].state = 'pause';
      audo.src = this.dataList[this.k].src;
      // #endif

      // èµ‹å€¼è§†é¢‘ID
      this.videoID = this.dataList[this.k]._id;

      // è®¾ç½®åˆ†äº«
      this.wxShare();

      // åŠ è½½åˆ—è¡¨ä¸‹ä¸€ç»„
      this.GET();
    },

    // å¾®ä¿¡jssdkè®¾ç½®åˆ†äº«
    wxShare() {
      // æœ‹å‹åˆ†äº«
      wx.updateAppMessageShareData({
        title: `ï¼ˆ${this.tenantInfo.name}ï¼‰${this.dataList[this.k].title}` || '',
        desc: this.dataList[this.k].msg || '',
        link: `${window.location.href.split('?')[0]}?id=${this.dataList[this.k]._id}&classId=${
          this.classID
        }&invitationID=${this.userInfo.id}&invitationTenantID=${this.tenantInfo.id}`,
        imgUrl: this.dataList[this.k].src + '?vframe/jpg/offset/1/w/600'
      });

      // æœ‹å‹åœˆåˆ†äº«
      wx.updateTimelineShareData({
        title: `ï¼ˆ${this.tenantInfo.name}ï¼‰${this.dataList[this.k].title}` || '',
        link: `${window.location.href.split('?')[0]}?id=${this.dataList[this.k]._id}&classId=${
          this.classID
        }&invitationID=${this.userInfo.id}&invitationTenantID=${this.tenantInfo.id}`,
        imgUrl: this.dataList[this.k].src + '?vframe/jpg/offset/1/w/600'
      });
    },

    // ç‚¹å‡»åˆ†äº«æŒ‰é’®
    share() {
      uni.showToast({
        title: 'åˆ†äº«',
        icon: 'none'
      });
    },

    // ç‚¹å‡»è¯„è®ºä¹‹åæ‰§è¡Œ
    toComment(index) {
      // æ³¨æ„ç‚¹å‡»è¯„è®ºä¹‹åä¼šæ‰§è¡Œè¿™é‡Œ
      /*
				ï¼ˆ1ï¼‰å…ˆåŠ è½½ç¼“å†²
				ï¼ˆ2ï¼‰è·å–å½“å‰è§†é¢‘ ID ä¿¡æ¯
				ï¼ˆ3ï¼‰ğŸŒŸğŸŒŸğŸŒŸğŸŒŸé‡è¦ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ
					- ä¸€å®šè¦è®°å¾—çœ‹ index.vue é‡Œé¢
					 uni.setStorageSync("user",this.peopleList[i]);
					 è¿™ä¸ªä¸œè¥¿ï¼Œç”¨äºå­˜å‚¨å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚åœ¨ æ’ä»¶é‡Œé¢ä¼šä½¿ç”¨åˆ°è¿™ä¸ªä¸œè¥¿ï¼Œ
					 è®°å¾—å†™ä¸€ä¸‹ã€‚

				ï¼ˆ4ï¼‰æ‰“å¼€è¯„è®º
				*/

      uni.showToast({
        title: 'åŠ è½½ä¸­...',
        icon: 'none',
        position: 'bottom',
        duration: 300
      });
      uni.setStorageSync('videoID', this.dataList[index]._id);
      this.videoID = this.dataList[index]._id;
      this.$refs.pinglun.open('bottom');
    },

    // ç‚¹å‡»å–œæ¬¢æ—¶æ‰§è¡Œ
    cLike(sss) {
      this.dataList[this.k].like = !this.dataList[this.k].like;
      const video = this.dataList[this.k];
      sss ? (video.like_n -= 1) : (video.like_n += 1);
    },

    // æ’­æ”¾è¿›åº¦å˜åŒ–æ—¶è§¦å‘
    timeupdate(e) {
      const id = e.target.id.split('_')[1];
      this.dataList[id].playbackProgress = e.detail.currentTime;
    },

    // åŠ è½½ç»“æŸ
    endLoading(e) {
      const id = e.target.id.split('_')[1];
      // èµ„æºåŠ è½½å®Œæˆ
      this.dataList[id].resourceLoading = true;
      // æ€»è¿›åº¦
      this.dataList[id].totalProgress = e.detail.duration;
    },

    // è¿›åº¦æ¡å˜åŒ–
    sliderChange(value) {
      audo.seek(value);
      uni.createVideoContext(this.dataList[this.k]._id + '_' + this.k, this).seek(value);
    }
  }
};
</script>

<style scoped>
.container {
  background-color: #000000;
}

.item {
  /* width : 750rpx; */
  background-color: #000000;
  position: relative;
}

.videoHover {
  position: absolute;
  top: 0;
  left: 0;
  flex: 1;
  background-color: rgba(0, 0, 0, 0.1);
  justify-content: center;
  align-items: center;
  box-sizing: border-box;

  /* border-style: dashed;
  border-color: #dd524d;
  border-width: 1px; */
}

.playState {
  padding: 20rpx;
  width: 110rpx;
  height: 110rpx;
  opacity: 0.5;
  background-color: #000000;
  border-radius: 50%;
}

.userInfo {
  position: absolute;
  bottom: 110px;
  right: 10px;
  flex-direction: column;
}

.userAvatar {
  border-radius: 500%;
  margin-bottom: 15px;
  border-style: solid;
  border-width: 2px;
  border-color: #ffffff;
}

.userAvatar {
  width: 100rpx;
  height: 100rpx;
}

.likeIco,
.shareIco,
.commentIco {
  width: 60rpx;
  height: 60rpx;
  margin-top: 15px;
}

.likeNum,
.commentNum,
.shareTex {
  color: #ffffff;
  font-size: 30rpx;
  text-align: center;
  margin: 5px;
}

.likeNumActive {
  color: red;
}

.content {
  padding-left: 20rpx;
  padding-bottom: 20rpx;
  justify-content: flex-start;
  color: #ffffff;
}

.userName {
  font-size: 30rpx;
  color: #ffffff;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 1;
  -webkit-box-orient: vertical;
}

.words {
  margin-top: 10rpx;
  font-size: 26rpx;
  color: #ffffff;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 1;
  -webkit-box-orient: vertical;
}

.root {
  background-color: #000000;
}
</style>
